FROM node:lts-alpine AS build

RUN apk update && apk add moreutils

RUN npm install uglify-js -g

COPY html html/

RUN for file in html/js/*.js; \
    do uglifyjs --compress --mangle -- $file | sponge $file; \
    done

FROM nginx:1.23.4-alpine-slim

COPY --from=build html /usr/share/nginx/html

ENTRYPOINT ["nginx", "-g", "daemon off;"]
